<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>期权工具 - 收益分析</title>
    <link rel="icon" href="data:image/ico;base64,aWNv">
    <link rel="stylesheet" href="layui/css/layui.css">
    <style>
        .income-card {
            border-radius: 4px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .income-header {
            padding: 15px;
            background-color: #f8f8f8;
            border-bottom: 1px solid #eee;
        }
        .income-body {
            padding: 15px;
        }
        .income-value {
            font-size: 24px;
            font-weight: bold;
            color: #1E9FFF;
        }
        .income-label {
            font-size: 14px;
            color: #666;
        }
        .income-item {
            margin-bottom: 10px;
        }
        .strategy-item {
            border-left: 3px solid #1E9FFF;
            padding-left: 10px;
            margin-bottom: 10px;
        }
        .chart-container {
            margin-top: 20px;
            padding: 15px;
            background-color: #fff;
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .layui-badge {
            margin-left: 5px;
        }
        .positive-value {
            color: #FF5722;
        }
        .negative-value {
            color: #5FB878;
        }
        /* 添加触发行权价的样式 */
        .strike-alert {
            background-color: rgba(255, 87, 34, 0.15) !important;
        }
        .strike-alert:hover {
            background-color: rgba(255, 87, 34, 0.25) !important;
        }
        .current-price {
            margin-left: 5px;
            background-color: #1E9FFF;
        }
    </style>
</head>
<body>
<div class="layui-layout layui-layout-admin">
    <div class="layui-header">
        <div class="layui-logo layui-hide-xs layui-bg-black">Options</div>
        <!-- 头部区域（可配合layui 已有的水平导航） -->
    </div>
    <div class="layui-side layui-bg-black">
        <div class="layui-side-scroll">
            <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
            <ul class="layui-nav layui-nav-tree">
                <li class="layui-nav-item">
                    <a href="index.html">标的分析</a>
                </li>
                <li class="layui-nav-item">
                    <a href="order.html">策略订单</a>
                </li>
                <li class="layui-nav-item layui-nav-itemed layui-this">
                    <a href="javascript:;">账户收益</a>
                </li>
                <li class="layui-nav-item"><a href="assistant.html">AI 助手</a></li>
                <li class="layui-nav-item"><a href="sync.html">同步订单</a></li>
                <li class="layui-nav-item"><a href="admin.html">后台管理</a></li>
            </ul>
        </div>
    </div>
    <div class="layui-body">
        <!-- 内容主体区域 -->
        <div style="padding: 15px;">
        <input type="hidden" id="owner"/>
        <div class="layui-form">
            <div class="layui-form-item">
                <div class="layui-inline">
                    <label class="layui-form-label">交易验证码</label>
                    <div class="layui-input-inline">
                        <input type="text" id="totp" name="totp" placeholder="请输入OTP验证码" autocomplete="off" class="layui-input">
                    </div>
                    <button type="button" class="layui-btn" id="refreshBtn">刷新数据</button>
                </div>
            </div>
        </div>

        <div class="layui-card layui-panel">
            <div class="layui-card-body" id="result" lay-filter="result">
                <div class="layui-progress layui-progress-big" lay-showpercent="true" lay-filter="loading">
                    <div class="layui-progress-bar" lay-percent="0%"></div>
                </div>
                <div class="layui-text" style="text-align: center; padding: 20px;">
                    正在加载收益数据，请稍候...
                </div>
            </div>
        </div>
    </div>

</div>
<script id="summary" type="text/html">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md3">
            <div class="income-card">
                <div class="income-header">
                    <h3>总已到账收入</h3>
                </div>
                <div class="income-body">
                    <div class="income-value">${{ d.allOptionsIncome }}</div>
                    <div class="income-item">
                        <span class="income-label">已扣除手续费:</span>
                        <span class="layui-badge layui-bg-orange">${{ d.totalFee }}</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-col-md3">
            <div class="income-card">
                <div class="income-header">
                    <h3>总未到期收入</h3>
                </div>
                <div class="income-body">
                    <div class="income-value">${{ d.unrealizedOptionsIncome }}</div>
                    <div class="income-item">
                        <span class="income-label">未平仓订单:</span>
                        <span class="layui-badge">{{= d.unrealizedOrders?d.unrealizedOrders.length:0}}单</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-col-md3">
            <div class="income-card">
                <div class="income-header">
                    <h3>策略总收益</h3>
                </div>
                <div class="income-body">
                    <div class="income-value">${{ d.allOptionsIncome }}</div>
                    <div class="income-item">
                        <span class="income-label">策略数量:</span>
                        <span class="layui-badge layui-bg-blue">{{= d.strategySummaries.length}}</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-col-md3">
            <div class="income-card">
                <div class="income-header">
                    <h3>资金剩余额度</h3>
                </div>
                <div class="income-body">
                    <div class="income-value" title="({{= d.accountSize}}) - ({{= d.totalStockCost}}) - ({{= d.putMarginOccupied}})">${{ d.availableFunds }}</div>
                    <div class="income-item">
                        <span class="income-label">投入资金:</span>
                        <span class="layui-badge layui-bg-blue">${{= d.accountSize}}</span>
                        <span class="income-label">Put占用:</span>
                        <span class="layui-badge layui-bg-red">${{= d.putMarginOccupied}}</span>
                        <span class="income-label">持股占用:</span>
                        <span class="layui-badge layui-bg-orange ">${{= d.totalStockCost}}</span>
                        <span class="income-label">保证金比例:</span>
                        <span class="layui-badge layui-bg-orange ">{{= (d.marginRatio * 100) + '%' }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="layui-card income-card" style="margin-top: 20px;">
        <div class="layui-card-header">未平仓期权订单 <span class="layui-badge">{{= d.unrealizedOrders?d.unrealizedOrders.length:0}}单</span></div>
        <div class="layui-card-body">
            <div id="orderTable"></div>
        </div>
    </div> 

    <div class="layui-row layui-col-space15" style="margin-top: 20px;">
        <div class="layui-col-md12">
            <div class="layui-card income-card">
                <div class="layui-card-header">月度收益趋势 <span class="layui-badge">统计近{{= Object.keys(d.monthlyIncome).length }}个月数据</span></div>
                <div class="layui-card-body">
                    <canvas id="monthlyIncomeChart" height="300" width="100%"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="layui-card income-card" style="margin-top: 20px;">
        <div class="layui-card-header">策略收益明细</div>
        <div class="layui-card-body">
            <div class="layui-collapse">
            {{#  layui.each(d.strategySummaries, function(index, item){ }}
                <div class="layui-colla-item">
                    <div class="layui-colla-title">
                        <span style="font-weight: bold;">{{ item.strategy.strategyName }}</span>
                        <span class="layui-badge layui-bg-blue" style="margin-left: 10px;">${{ item.allOptionsIncome }}</span>
                        <span style="margin-left: 10px; color: #666;">策略代码: {{ item.strategy.strategyCode }}</span>
                    </div>
                    <div class="layui-colla-content">
                        <div class="layui-row layui-col-space15">
                            <div class="layui-col-md6">
                                <div class="strategy-item">
                                    <div><span style="font-weight: bold;">策略ID:</span> {{ item.strategy.strategyId }}</div>
                                    <div><span style="font-weight: bold;">期权已到账收入:</span> ${{ item.allOptionsIncome }} <span style="color: #FF5722;">(已扣除手续费${{ item.totalFee }})</span></div>
                                    <div><span style="font-weight: bold;">期权未到期收入:</span> ${{ item.unrealizedOptionsIncome }}</div>
                                </div>
                            </div>
                            <div class="layui-col-md6">
                                <div class="strategy-item">
                                    <div><span style="font-weight: bold;">策略持有股票:</span> {{ item.holdStockNum }} 股</div>
                                    <div><span style="font-weight: bold;">当前股价:</span> ${{ item.currentStockPrice }}</div>
                                    <div><span style="font-weight: bold;">策略股票花费:</span> ${{ item.totalStockCost }} <span style="color: #1E9FFF;">(平均成本: ${{ item.averageStockCost }})</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {{#  }); }}
            </div>
        </div>
    </div>
    
</script>
<script src="layui/layui.js"></script>
<script src="chart/chart.js"></script>
<script src="common.js"></script>
<script src="income.js"></script>
</body>
</html>